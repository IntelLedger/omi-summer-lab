

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modifying the OMI Transaction Processor &mdash; OMI Summer Lab latest documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="OMI Summer Lab latest documentation" href="index.html"/>
        <link rel="next" title="OMI Client JavaScript SDK" href="omi_client.html"/>
        <link rel="prev" title="Getting Started" href="getting_started.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="contents.html" class="icon icon-home"> OMI Summer Lab
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Welcome to OMI Summer Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modifying the OMI Transaction Processor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-the-hyperledger-sawtooth-python-sdk">Getting the Hyperledger Sawtooth Python SDK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-the-sdk">Preparing the SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-validator">Running the Validator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-omi-transaction-processor">Running the OMI Transaction Processor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gathering-dependencies">Gathering Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-transaction-processor">Running the Transaction Processor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#making-changes-to-the-transaction-processor">Making changes to the Transaction Processor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="omi_client.html">OMI Client JavaScript SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction_family_specification.html">OMI Summer Lab Transaction Family Specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">OMI Summer Lab</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="contents.html">Docs</a> &raquo;</li>
        
      <li>Modifying the OMI Transaction Processor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/txn_processor_dev.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modifying-the-omi-transaction-processor">
<h1>Modifying the OMI Transaction Processor<a class="headerlink" href="#modifying-the-omi-transaction-processor" title="Permalink to this headline">¶</a></h1>
<p>This guide will help you add your own changes to the OMI Summer Lab Transaction
Processor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more inforamation on Transaction Processors in Hyperledger Sawtooth,
checkout the <a class="reference external" href="https://intelledger.github.io/app_developers_guide.html">Applpication Developer’s Guide</a>, paying close
attention to the Python SDK section</p>
</div>
<div class="section" id="getting-the-hyperledger-sawtooth-python-sdk">
<h2>Getting the Hyperledger Sawtooth Python SDK<a class="headerlink" href="#getting-the-hyperledger-sawtooth-python-sdk" title="Permalink to this headline">¶</a></h2>
<p>Transaction processors may be written in a number of languages, but the OMI
Transaction Processor is implemented using the Sawtooth Python SDK.  This is
currently not available via standard Python dependency tools (e.g. <cite>pip</cite>), so
you’ll need to checkout the Hyperledger Sawtooth repository.  Assuming you have
<cite>git</cite> installed from the previous section:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone https://github.com/hyperledger/sawtooth-core
</pre></div>
</div>
<p>It is recommended that you clone <cite>sawtooth-core</cite> into the same parent directory
of <cite>omi-summer-lab</cite>.</p>
<div class="section" id="preparing-the-sdk">
<h3>Preparing the SDK<a class="headerlink" href="#preparing-the-sdk" title="Permalink to this headline">¶</a></h3>
<p>The Sawtooth Python SDK requires a bit of preparation for use with the OMI
Transaction Processor.  You will need <a class="reference external" href="https://www.python.org/downloads/">Python 3</a> installed for all of the following
commands.</p>
<p>In <cite>sawtooth-core</cite>, run the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> pip3 install grpcio-tools
<span class="go">...</span>
<span class="go">Successfully installed grpcio-1.3.5 grpcio-tools-1.3.5 protobuf-3.3.0 six-1.10.0</span>
<span class="gp">$</span> ./bin/protogen
</pre></div>
</div>
<p>This last command has no output.</p>
<p>Add the now-ready Sawtooth Python SDK to your Python path:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>&lt;parent directory&gt;/sawtooth-core/sdk/python:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-validator">
<h3>Running the Validator<a class="headerlink" href="#running-the-validator" title="Permalink to this headline">¶</a></h3>
<p>As we did in the previous section we’ll use <cite>docker compose</cite> to start up a
validator instance, a config transaction processor, and a REST API process, but
we will be starting up the OMI Transaction Processor ourselves.  We’ve provided
a separate compose file to start this subset of components:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-compose -f omi-summer-lab/docker/compose-without-omi.yaml up
</pre></div>
</div>
<p>To stop the validator node, press Ctrl-c and then run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> docker-compose -f omi-summer-lab/docker/compose-without-omi.yaml down
</pre></div>
</div>
</div>
<div class="section" id="running-the-omi-transaction-processor">
<h3>Running the OMI Transaction Processor<a class="headerlink" href="#running-the-omi-transaction-processor" title="Permalink to this headline">¶</a></h3>
<p>With the validator started, we can move on to running our version of the OMI
Transaction Processor.</p>
<div class="section" id="gathering-dependencies">
<h4>Gathering Dependencies<a class="headerlink" href="#gathering-dependencies" title="Permalink to this headline">¶</a></h4>
<p>We’ll need a few more Python dependencies.  We’ve provided a <cite>requirements.txt</cite>
with the remaining items needed. In the <cite>omi-summer-lab</cite> directory, run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> pip3 install -r requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="running-the-transaction-processor">
<h4>Running the Transaction Processor<a class="headerlink" href="#running-the-transaction-processor" title="Permalink to this headline">¶</a></h4>
<p>We can now run the Transaction Processor. In the <cite>omi-summer-lab</cite> directory,
run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ./bin/omi-tp -vv tcp://localhost:40000
<span class="go">[17:21:50 DEBUG   selector_events] Using selector: ZMQSelector</span>
<span class="go">[17:21:50 INFO    core] register attempt: OK</span>
</pre></div>
</div>
<p>This will start the transaction processor and connect it to the running
validator we started in the previous section.</p>
</div>
<div class="section" id="making-changes-to-the-transaction-processor">
<h4>Making changes to the Transaction Processor<a class="headerlink" href="#making-changes-to-the-transaction-processor" title="Permalink to this headline">¶</a></h4>
<p>Modifications to the Transaction Processor can be made by editing the
Transaction Handler implementation found at
<cite>omi-summer-lab/omi/sawtooth_omi/handler.py</cite>.  The important method to focus on
in this file is <cite>OMITransactionHandler.apply</cite>. This is where the operations of
validating the transaction payload and setting global state values happen.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the Application Developer’s Guide section on <a class="reference external" href="https://intelledger.github.io/_autogen/sdk_TP_tutorial_python.html#the-apply-method">The apply Method</a>
for more information.</p>
</div>
<p>Currently, this handler implementation writes OMI objects to the global state,
and validates ownership based on the public key associated with the enclosing
transaction.</p>
<p>You could, for example, build a payment record transaction for a number of
plays of a song from a streaming service. The transaction would contain the
song identifier and the number of plays and the total payment and would be
signed by the streaming service identity (e.g. “youtube” or “spotify”). The
Transaction Processor would calculate the splits based on the fractional artist
participation based on the song “tree” and would create records in state
indicating payments to artists as a result of the plays.</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="omi_client.html" class="btn btn-neutral float-right" title="OMI Client JavaScript SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Intel Corporation.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'latest',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>